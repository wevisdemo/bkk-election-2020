var it=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var G=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var j=(c,n,a)=>n in c?it(c,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[n]=a,D=(c,n)=>{for(var a in n||(n={}))rt.call(n,a)&&j(c,a,n[a]);if(G)for(var a of G(n))at.call(n,a)&&j(c,a,n[a]);return c},x=(c,n)=>nt(c,ot(n));import{L as lt,O as st,T as ct,d as dt,A as ut,V as pt,W as H,a as L,M as k,S as K,b as ht,c as ft,C as gt}from"./MapHelper.7a3aa7ed.js";import{F as wt,p as Et,h as S,m as W,j as _,a as mt,_ as Tt,y as F,b as bt,D as vt,E as Dt}from"./index.d25c8773.js";import{D as xt}from"./DistrictTooltip.5bb7e316.js";lt.registerPlugin(st);const At=({onDistrictClick:c})=>{const n=wt(Et),a=S(null),h=S(null),[I,Y]=W(),[m,q]=W(),[z,J]=W(!1),M=S(0),[T,y]=W({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!n)return _(mt,{});const{electionData:P,candidateMap:O}=n,[A,X]=W([]);let V=5e4;const B=e=>{let t=O[e];return t?t.color:vt},Z=new ct({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),Q=(e,t)=>{e.on("pointerdown",l=>{M.current=Date.now()}),e.on("pointerup",l=>{Date.now()-M.current<gt&&t()})},$=(e,t)=>{if(A.length>0){tt(t);const l=e.loader.resources.stripe.animation,r=100,d=20,w=23;A.forEach(u=>{const{coordinate:o,district:p,ratio:b,districtCandidateVoteRatio:f}=u,s=Math.sqrt(r*r*b),v=o.col*r+r*.5-s*.5+o.col*d;let g=o.row*r+r*.5-s*.5+o.row*d;g+=w;const i=new K;i.beginFill(4473924),i.drawRect(v,g,s,s),i.endFill(),i.interactive=!0,i.buttonMode=!0,Q(i,()=>c==null?void 0:c(p)),i.on("pointerover",E=>{i.tint=6710886,y(R=>x(D({},R),{district:p,show:!0}))}),i.on("pointerout",E=>{i.tint=16777215,y(R=>x(D({},R),{show:!1}))});let N=0;if(f.forEach(({percentage:E,color:R},et)=>{if(et>k-1)return;const U=s*E/100;i.lineStyle(1,0,1),i.beginFill(+R.replace("#","0x"),1,!0),i.drawRect(v,g+N,s,U||0),i.endFill(),N+=U}),P.type===Dt.Live){const E=i.getBounds();i.beginTextureFill({alpha:.2,texture:l==null?void 0:l.texture,matrix:new ht(E.width/30,0,0,E.height/30,E.x,E.y)}),i.drawRect(v,g,s,s),i.endFill()}t.addChild(i);const C=new ft(p.name==="\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E28\u0E31\u0E15\u0E23\u0E39\u0E1E\u0E48\u0E32\u0E22"?"\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E2F":p.name,Z);C.x=v+s*.5,C.y=g-10,C.anchor.set(.5),t.addChild(C)})}},tt=e=>{const t=new K;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return Tt(()=>{if(!n)return;const{districts:e}=P;let t=e.reduce((r,d)=>r.voting.eligiblePopulation>d.voting.eligiblePopulation?r:d);t&&(V=t.voting.eligiblePopulation);let l=[];e.forEach(r=>{const{voting:d}=r;let w=d.eligiblePopulation/V;w=isNaN(w)?0:w;let u=[],o=0;d.result.forEach((p,b)=>{b===d.result.length-1?u.push({percentage:100-o,color:B(p.candidateId)}):(u.push({percentage:Math.floor(p.count/d.totalVotes*100),color:B(p.candidateId)}),o+=p.count/d.totalVotes*100)}),l.push(new dt(r,O,w,u))}),X(l)},[n]),F(()=>{var t,l,r;if(!h.current)return;const e=new ut({width:((t=h.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((l=h.current.parentElement)==null?void 0:l.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0,resizeTo:h.current.parentElement||void 0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((d,w)=>{var p,b;const u=w.stripe.animation;u&&(u.x=-u.width,u.y=-u.height,e.stage.addChild(u));const o=new pt({screenWidth:(p=h.current)==null?void 0:p.clientWidth,screenHeight:(b=h.current)==null?void 0:b.clientHeight,worldWidth:H,worldHeight:L,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(o),o.on("pointermove",f=>{if(a.current){const{clientHeight:s,clientWidth:v}=a.current,g=!(f.data.global.y>s*.33);y(i=>x(D({},i),{left:f.data.global.x-15,top:g?f.data.global.y+20:"unset",bottom:g?"unset":s-f.data.global.y+10,pointUp:g,anchorRight:f.data.global.x>v*.66}))}}),o.on("pointerdown",f=>{f.target.cursor!=="pointer"&&y(s=>x(D({},s),{show:!1}))}),o.drag().pinch().wheel(),o.clamp({top:0,bottom:L,left:0,right:H}),o.clampZoom({minWidth:300,minHeight:300,maxWidth:5e3,maxHeight:5e3}),o.fit(),o.moveCenter(H/2,L/2),Y(e),q(o),J(!0)}),(r=h.current)==null||r.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),F(()=>{I&&m&&z&&(m.removeChildren(),$(I,m),y(e=>x(D({},e),{show:!1})))},[z,A]),F(()=>{if(typeof window=="undefined")return;const e=()=>{var t,l;!m||!h.current||(m.fit(),m.resize(((t=h.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,((l=h.current.parentElement)==null?void 0:l.clientHeight)||window.innerHeight))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[window,m]),bt("div",{className:"relative h-full",class:"overflow-hidden",ref:a,children:[_("div",{className:"w-full h-full",ref:h}),_(xt,{show:T.show,district:T.district,style:{left:T.left,top:T.top,bottom:T.bottom},pointUp:T.pointUp,topCandidateDisplay:k,anchorRight:T.anchorRight})]})};export{At as default};
