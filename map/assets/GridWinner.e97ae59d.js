var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var M=(l,i,r)=>i in l?J(l,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[i]=r,E=(l,i)=>{for(var r in i||(i={}))Z.call(i,r)&&M(l,r,i[r]);if(B)for(var r of B(i))q.call(i,r)&&M(l,r,i[r]);return l},T=(l,i)=>X(l,Y(i));import{L as Q,O as $,T as tt,D as et,A as nt,V as it,W as H,a as R,M as ot,S as P,b as rt,c as at}from"./MapHelper.8d86c6e2.js";import{F as st,p as lt,h as L,m as y,j as S,a as dt,_ as ct,y as A,b as ut,E as pt}from"./index.acc9879d.js";import{D as ht}from"./DistrictTooltip.45d22cf4.js";const ft=200;Q.registerPlugin($);const Tt=({onDistrictClick:l})=>{const i=st(lt),r=L(null),d=L(null),[C,I]=y(),[h,O]=y(),[_,U]=y(!1),F=L(0),[f,b]=y({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!i)return S(dt,{});const{electionData:z,candidateMap:G}=i,[D,j]=y([]),N=new tt({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),V=(e,t)=>{e.on("pointerdown",a=>{F.current=Date.now()}),e.on("pointerup",a=>{Date.now()-F.current<ft&&t()})},k=(e,t)=>{if(D.length>0){K(t);const a=e.loader.resources.stripe.animation,o=100,g=20;D.forEach(W=>{const{coordinate:c,district:s,highestScoreCandidate:v}=W,m=c.col*o+c.col*g,u=c.row*o+c.row*g,n=new P;if(v&&n.beginFill(+v.color.replace("#","0x"),1,!0),n.drawRoundedRect(m,u,o,o,2),n.endFill(),n.interactive=!0,n.buttonMode=!0,V(n,()=>l==null?void 0:l(s)),n.on("pointerover",p=>{n.tint=6710886,b(x=>T(E({},x),{district:s,show:!0}))}),n.on("pointerout",p=>{n.tint=16777215,b(x=>T(E({},x),{show:!1}))}),z.type===pt.Live){const p=n.getBounds();n.beginTextureFill({alpha:.2,texture:a==null?void 0:a.texture,matrix:new rt(p.width/30,0,0,p.height/30,p.x,p.y)}),n.drawRect(m,u,o,o),n.endFill()}t.addChild(n);const w=new at(s.name==="\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E28\u0E31\u0E15\u0E23\u0E39\u0E1E\u0E48\u0E32\u0E22"?"\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E2F":s.name,N);w.x=m+o*.5,w.y=u+o*.5,w.anchor.set(.5),t.addChild(w)})}},K=e=>{const t=new P;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return ct(()=>{if(!i)return;const{districts:e}=z;let t=e.reduce((o,g)=>o.voting.eligiblePopulation>g.voting.eligiblePopulation?o:g);t&&t.voting.eligiblePopulation;let a=[];e.forEach(o=>{a.push(new et(o,G))}),j(a)},[i]),A(()=>{var t,a,o;if(!d.current)return;const e=new nt({width:((t=d.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((a=d.current.parentElement)==null?void 0:a.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0,resizeTo:d.current.parentElement||void 0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((g,W)=>{var v,m;const c=W.stripe.animation;c&&(c.x=-c.width,c.y=-c.height,e.stage.addChild(c));const s=new it({screenWidth:(v=d.current)==null?void 0:v.clientWidth,screenHeight:(m=d.current)==null?void 0:m.clientHeight,worldWidth:H,worldHeight:R,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(s),s.on("pointermove",u=>{if(r.current){const{clientWidth:n,clientHeight:w}=r.current,p=!(u.data.global.y>w*.33);b(x=>T(E({},x),{left:u.data.global.x-15,top:p?u.data.global.y+20:"unset",bottom:p?"unset":w-u.data.global.y+10,pointUp:p,anchorRight:u.data.global.x>n*.66}))}}),s.on("pointerdown",u=>{u.target.cursor!=="pointer"&&b(n=>T(E({},n),{show:!1}))}),s.drag().pinch().wheel(),s.clamp({top:0,bottom:R,left:0,right:H}),s.clampZoom({minWidth:300,minHeight:300,maxWidth:5e3,maxHeight:5e3}),s.fit(),s.moveCenter(H/2,R/2),I(e),O(s),U(!0)}),(o=d.current)==null||o.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),A(()=>{C&&h&&_&&(h.removeChildren(),k(C,h),b(e=>T(E({},e),{show:!1})))},[_,D]),A(()=>{if(typeof window=="undefined")return;const e=()=>{var t,a;!h||!d.current||(h.fit(),h.resize(((t=d.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,((a=d.current.parentElement)==null?void 0:a.clientHeight)||window.innerHeight))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[window,h]),ut("div",{className:"relative h-full",class:"overflow-hidden",ref:r,children:[S("div",{className:"w-full h-full",ref:d}),S(ht,{show:f.show,district:f.district,style:{left:f.left,top:f.top,bottom:f.bottom},pointUp:f.pointUp,topCandidateDisplay:ot,anchorRight:f.anchorRight})]})};export{Tt as default};
