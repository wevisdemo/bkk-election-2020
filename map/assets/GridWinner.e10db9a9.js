var J=Object.defineProperty,X=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var Z=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var B=(l,i,a)=>i in l?J(l,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[i]=a,E=(l,i)=>{for(var a in i||(i={}))Z.call(i,a)&&B(l,a,i[a]);if(z)for(var a of z(i))q.call(i,a)&&B(l,a,i[a]);return l},b=(l,i)=>X(l,Y(i));import{L as Q,O as $,T as tt,D as et,A as nt,V as it,W as H,a as R,M as ot,S as M,b as rt,c as at}from"./MapHelper.03caed29.js";import{F as st,p as lt,h as S,m as y,j as A,a as dt,_ as ct,y as C,b as ut}from"./index.fa2ba1ab.js";import{D as pt}from"./DistrictTooltip.1d1216f9.js";const ht=200;Q.registerPlugin($);const Et=({onDistrictClick:l})=>{const i=st(lt),a=S(null),d=S(null),[L,P]=y(),[h,I]=y(),[_,O]=y(!1),F=S(0),[f,T]=y({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!i)return A(dt,{});const{electionData:U,candidateMap:G}=i,[D,j]=y([]),N=new tt({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),V=(e,t)=>{e.on("pointerdown",s=>{F.current=Date.now()}),e.on("pointerup",s=>{Date.now()-F.current<ht&&t()})},k=(e,t)=>{if(D.length>0){K(t);const s=e.loader.resources.stripe.animation,o=100,w=20;D.forEach(W=>{const{coordinate:c,district:r,highestScoreCandidate:v}=W,m=c.col*o+c.col*w,u=c.row*o+c.row*w,n=new M;if(v&&n.beginFill(+v.color.replace("#","0x"),1,!0),n.drawRoundedRect(m,u,o,o,2),n.endFill(),n.interactive=!0,n.buttonMode=!0,V(n,()=>l==null?void 0:l(r)),n.on("pointerover",p=>{n.tint=6710886,T(x=>b(E({},x),{district:r,show:!0}))}),n.on("pointerout",p=>{n.tint=16777215,T(x=>b(E({},x),{show:!1}))}),typeof r.voting.progress!="undefined"&&r.voting.progress<100){const p=n.getBounds();n.beginTextureFill({alpha:.2,texture:s==null?void 0:s.texture,matrix:new rt(p.width/30,0,0,p.height/30,p.x,p.y)}),n.drawRect(m,u,o,o),n.endFill()}t.addChild(n);const g=new at(r.name==="\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E28\u0E31\u0E15\u0E23\u0E39\u0E1E\u0E48\u0E32\u0E22"?"\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E2F":r.name,N);g.x=m+o*.5,g.y=u+o*.5,g.anchor.set(.5),t.addChild(g)})}},K=e=>{const t=new M;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return ct(()=>{if(!i)return;const{districts:e}=U;let t=e.reduce((o,w)=>o.voting.eligiblePopulation>w.voting.eligiblePopulation?o:w);t&&t.voting.eligiblePopulation;let s=[];e.forEach(o=>{s.push(new et(o,G))}),j(s)},[i]),C(()=>{var t,s,o;if(!d.current)return;const e=new nt({width:((t=d.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((s=d.current.parentElement)==null?void 0:s.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0,resizeTo:d.current.parentElement||void 0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((w,W)=>{var v,m;const c=W.stripe.animation;c&&(c.x=-c.width,c.y=-c.height,e.stage.addChild(c));const r=new it({screenWidth:(v=d.current)==null?void 0:v.clientWidth,screenHeight:(m=d.current)==null?void 0:m.clientHeight,worldWidth:H,worldHeight:R,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(r),r.on("pointermove",u=>{if(a.current){const{clientWidth:n,clientHeight:g}=a.current,p=!(u.data.global.y>g*.33);T(x=>b(E({},x),{left:u.data.global.x-15,top:p?u.data.global.y+20:"unset",bottom:p?"unset":g-u.data.global.y+10,pointUp:p,anchorRight:u.data.global.x>n*.66}))}}),r.on("pointerdown",u=>{u.target.cursor!=="pointer"&&T(n=>b(E({},n),{show:!1}))}),r.drag().pinch().wheel(),r.clamp({top:0,bottom:R,left:0,right:H}),r.clampZoom({minWidth:300,minHeight:300,maxWidth:5e3,maxHeight:5e3}),r.fit(),r.moveCenter(H/2,R/2),P(e),I(r),O(!0)}),(o=d.current)==null||o.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),C(()=>{L&&h&&_&&(h.removeChildren(),k(L,h),T(e=>b(E({},e),{show:!1})))},[_,D]),C(()=>{if(typeof window=="undefined")return;const e=()=>{var t,s;!h||!d.current||(h.fit(),h.resize(((t=d.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,((s=d.current.parentElement)==null?void 0:s.clientHeight)||window.innerHeight))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[window,h]),ut("div",{className:"relative h-full",class:"overflow-hidden",ref:a,children:[A("div",{className:"w-full h-full",ref:d}),A(pt,{show:f.show,district:f.district,style:{left:f.left,top:f.top,bottom:f.bottom},pointUp:f.pointUp,topCandidateDisplay:ot,anchorRight:f.anchorRight})]})};export{Et as default};
