var it=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var rt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var G=(d,n,a)=>n in d?it(d,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[n]=a,x=(d,n)=>{for(var a in n||(n={}))rt.call(n,a)&&G(d,a,n[a]);if(U)for(var a of U(n))at.call(n,a)&&G(d,a,n[a]);return d},D=(d,n)=>nt(d,ot(n));import{L as lt,O as st,T as ct,d as dt,A as ut,V as pt,W as H,a as S,M as j,S as k,b as ht,c as gt,C as ft}from"./MapHelper.a5bdd777.js";import{F as wt,p as mt,h as L,m as W,j as _,a as Et,_ as bt,y as F,b as Tt,D as vt}from"./index.f153ed88.js";import{D as xt}from"./DistrictTooltip.7e3b7287.js";lt.registerPlugin(st);const Ct=({onDistrictClick:d})=>{const n=wt(mt),a=L(null),h=L(null),[I,K]=W(),[E,Y]=W(),[z,q]=W(!1),M=L(0),[b,y]=W({show:!1,district:void 0,left:"unset",top:"unset",bottom:"unset",pointUp:!0,anchorRight:!1});if(!n)return _(Et,{});const{electionData:J,candidateMap:P}=n,[A,X]=W([]);let O=5e4;const V=e=>{let t=P[e];return t?t.color:vt},Z=new ct({fontFamily:"Anuphan",fontSize:20,fontStyle:"normal",fontWeight:"600",fill:"#ffffff",stroke:"#000000",strokeThickness:6,lineJoin:"round",textBaseline:"bottom"}),Q=(e,t)=>{e.on("pointerdown",l=>{M.current=Date.now()}),e.on("pointerup",l=>{Date.now()-M.current<ft&&t()})},$=(e,t)=>{if(A.length>0){tt(t);const l=e.loader.resources.stripe.animation,r=100,u=20,w=23;A.forEach(p=>{const{coordinate:o,district:s,ratio:T,districtCandidateVoteRatio:g}=p,c=Math.sqrt(r*r*T),v=o.col*r+r*.5-c*.5+o.col*u;let f=o.row*r+r*.5-c*.5+o.row*u;f+=w;const i=new k;i.beginFill(4473924),i.drawRect(v,f,c,c),i.endFill(),i.interactive=!0,i.buttonMode=!0,Q(i,()=>d==null?void 0:d(s)),i.on("pointerover",m=>{i.tint=6710886,y(R=>D(x({},R),{district:s,show:!0}))}),i.on("pointerout",m=>{i.tint=16777215,y(R=>D(x({},R),{show:!1}))});let B=0;if(g.forEach(({percentage:m,color:R},et)=>{if(et>j-1)return;const N=c*m/100;i.lineStyle(1,0,1),i.beginFill(+R.replace("#","0x"),1,!0),i.drawRect(v,f+B,c,N||0),i.endFill(),B+=N}),typeof s.voting.progress!="undefined"&&s.voting.progress<100){const m=i.getBounds();i.beginTextureFill({alpha:.2,texture:l==null?void 0:l.texture,matrix:new ht(m.width/30,0,0,m.height/30,m.x,m.y)}),i.drawRect(v,f,c,c),i.endFill()}t.addChild(i);const C=new gt(s.name==="\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E28\u0E31\u0E15\u0E23\u0E39\u0E1E\u0E48\u0E32\u0E22"?"\u0E1B\u0E49\u0E2D\u0E21\u0E1B\u0E23\u0E32\u0E1A\u0E2F":s.name,Z);C.x=v+c*.5,C.y=f-10,C.anchor.set(.5),t.addChild(C)})}},tt=e=>{const t=new k;t.lineStyle(50,16777215,.3),t.moveTo(530,0),t.lineTo(530,170),t.lineTo(410,170),t.lineTo(410,530),t.lineTo(530,530),t.lineTo(530,770),t.lineTo(770,770),t.lineTo(770,650),t.lineTo(1010,650),t.lineTo(1010,740),e.addChild(t)};return bt(()=>{if(!n)return;const{districts:e}=J;let t=e.reduce((r,u)=>r.voting.eligiblePopulation>u.voting.eligiblePopulation?r:u);t&&(O=t.voting.eligiblePopulation);let l=[];e.forEach(r=>{const{voting:u}=r;let w=u.eligiblePopulation/O;w=isNaN(w)?0:w;let p=[],o=0;u.result.forEach((s,T)=>{T===u.result.length-1?p.push({percentage:100-o,color:V(s.candidateId)}):(p.push({percentage:Math.floor(s.count/u.totalVotes*100),color:V(s.candidateId)}),o+=s.count/u.totalVotes*100)}),l.push(new dt(r,P,w,p))}),X(l)},[n]),F(()=>{var t,l,r;if(!h.current)return;const e=new ut({width:((t=h.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,height:((l=h.current.parentElement)==null?void 0:l.clientHeight)||window.innerWidth,backgroundColor:0,antialias:!0,resolution:2,autoDensity:!0,resizeTo:h.current.parentElement||void 0});return e.loader.add("stripe","/map/images/strip-black.gif"),e.loader.load((u,w)=>{var s,T;const p=w.stripe.animation;p&&(p.x=-p.width,p.y=-p.height,e.stage.addChild(p));const o=new pt({screenWidth:(s=h.current)==null?void 0:s.clientWidth,screenHeight:(T=h.current)==null?void 0:T.clientHeight,worldWidth:H,worldHeight:S,passiveWheel:!1,stopPropagation:!0,interaction:e.renderer.plugins.interaction});e.stage.addChild(o),o.on("pointermove",g=>{if(a.current){const{clientHeight:c,clientWidth:v}=a.current,f=!(g.data.global.y>c*.33);y(i=>D(x({},i),{left:g.data.global.x-15,top:f?g.data.global.y+20:"unset",bottom:f?"unset":c-g.data.global.y+10,pointUp:f,anchorRight:g.data.global.x>v*.66}))}}),o.on("pointerdown",g=>{g.target.cursor!=="pointer"&&y(c=>D(x({},c),{show:!1}))}),o.drag().pinch().wheel(),o.clamp({top:0,bottom:S,left:0,right:H}),o.clampZoom({minWidth:300,minHeight:300,maxWidth:5e3,maxHeight:5e3}),o.fit(),o.moveCenter(H/2,S/2),K(e),Y(o),q(!0)}),(r=h.current)==null||r.appendChild(e.view),e.start(),()=>{e.destroy(!0)}},[]),F(()=>{I&&E&&z&&(E.removeChildren(),$(I,E),y(e=>D(x({},e),{show:!1})))},[z,A]),F(()=>{if(typeof window=="undefined")return;const e=()=>{var t,l;!E||!h.current||(E.fit(),E.resize(((t=h.current.parentElement)==null?void 0:t.clientWidth)||window.innerWidth,((l=h.current.parentElement)==null?void 0:l.clientHeight)||window.innerHeight))};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[window,E]),Tt("div",{className:"relative h-full",class:"overflow-hidden",ref:a,children:[_("div",{className:"w-full h-full",ref:h}),_(xt,{show:b.show,district:b.district,style:{left:b.left,top:b.top,bottom:b.bottom},pointUp:b.pointUp,topCandidateDisplay:j,anchorRight:b.anchorRight})]})};export{Ct as default};
